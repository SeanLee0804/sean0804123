<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>跨年倒數</title>

<style>
:root{
  --bg-color:#05070c;
  --glow-color:#4cc9ff;
}

*{margin:0;padding:0;box-sizing:border-box}

html,body{
  width:100%;
  height:100%;
  background:var(--bg-color);
  overflow:hidden;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  color:#fff;
}

/* ===== Canvas ===== */
canvas{
  position:fixed;
  inset:0;
  z-index:0;
}

/* ===== 主內容 ===== */
.container{
  position:relative;
  z-index:2;
  height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  padding:0 5vw;
}

.subtitle{
  opacity:.6;
  letter-spacing:.4em;
  margin-bottom:1.2rem;
  font-size:clamp(.8rem,2vw,1rem);
}

.countdown{
  font-size:clamp(2.6rem,7.5vw,6.8rem);
  font-weight:800;
  letter-spacing:.18em;
  text-shadow:
    0 0 22px var(--glow-color),
    0 0 45px var(--glow-color),
    0 0 90px rgba(76,201,255,.35);
}

@media (min-width:1024px){
  .countdown{font-size:7.5rem;}
}

.tz{
  margin-top:1.2rem;
  opacity:.6;
  font-size:.9rem;
}

/* ===== 光暈 ===== */
.glow{
  position:fixed;
  width:min(180px,45vw);
  height:min(180px,45vw);
  background:radial-gradient(circle, var(--glow-color), transparent 70%);
  filter:blur(45px);
  pointer-events:none;
  transform:translate(-50%,-50%);
  z-index:1;
}

/* ===== 控制面板 ===== */
.controls{
  position:fixed;
  bottom:1rem;
  right:1rem;
  z-index:3;
  background:rgba(0,0,0,.55);
  backdrop-filter:blur(12px);
  border-radius:14px;
  padding:12px;
  display:grid;
  gap:8px;
  font-size:12px;
}

.controls label{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:6px;
}

.controls input[type="range"]{width:120px}

@media(max-width:600px){
  .controls{scale:.9}
}
</style>
</head>

<body>

<canvas id="canvas"></canvas>
<div class="glow" id="glow"></div>

<div class="container">
  <div class="subtitle">距離跨年還有</div>
  <div class="countdown" id="countdown">計算中…</div>
  <div class="tz">Asia / Taipei</div>
</div>

<div class="controls">
  <label>背景
    <input type="color" id="bgColor" value="#05070c">
  </label>
  <label>粒子
    <input type="color" id="pColor" value="#4cc9ff">
  </label>
  <label>數量
    <input type="range" id="pCount" min="50" max="500" value="220">
  </label>
  <label>速度
    <input type="range" id="pSpeed" min="0.3" max="3" step="0.1" value="1">
  </label>
</div>

<script>
/* ===== 台北時間倒數 ===== */
const cd=document.getElementById("countdown");
function updateCountdown(){
  const now=new Date(new Date().toLocaleString("en-US",{timeZone:"Asia/Taipei"}));
  const target=new Date("2026-01-01T00:00:00+08:00");
  let diff=target-now;
  if(diff<0) diff=0;

  const d=Math.floor(diff/86400000);
  const h=Math.floor(diff%86400000/3600000);
  const m=Math.floor(diff%3600000/60000);
  const s=Math.floor(diff%60000/1000);

  cd.textContent=`${d} 天 ${h} 小時 ${m} 分 ${s} 秒`;
}
setInterval(updateCountdown,1000);
updateCountdown();

/* ===== 粒子系統（一開始就存在） ===== */
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

let particles=[];
let targetCount=220;
let speed=1;

function resize(){
  const dpr=window.devicePixelRatio||1;
  canvas.width=innerWidth*dpr;
  canvas.height=innerHeight*dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
window.addEventListener("resize",resize);
resize();

function createParticle(){
  return{
    x:Math.random()*innerWidth,
    y:Math.random()*innerHeight, // ⭐ 一開始就在畫面內
    r:Math.random()*2.2+1,
    v:Math.random()*0.6+0.4
  };
}

function syncParticles(){
  while(particles.length<targetCount) particles.push(createParticle());
  while(particles.length>targetCount) particles.pop();
}
syncParticles();

function animate(){
  ctx.clearRect(0,0,innerWidth,innerHeight);
  const color=getComputedStyle(document.documentElement).getPropertyValue("--glow-color");
  ctx.fillStyle=color;
  ctx.shadowColor=color;
  ctx.shadowBlur=20;

  for(const p of particles){
    p.y-=p.v*speed;
    if(p.y<-10){
      p.y=innerHeight+10;
      p.x=Math.random()*innerWidth;
    }
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fill();
  }
  requestAnimationFrame(animate);
}
animate();

/* ===== 控制（即時生效，不重跑） ===== */
bgColor.oninput=e=>{
  document.documentElement.style.setProperty("--bg-color",e.target.value);
};
pColor.oninput=e=>{
  document.documentElement.style.setProperty("--glow-color",e.target.value);
};
pCount.oninput=e=>{
  targetCount=+e.target.value;
  syncParticles();
};
pSpeed.oninput=e=>{
  speed=+e.target.value;
};

/* ===== 光暈（滑鼠 + 觸控） ===== */
const glow=document.getElementById("glow");
function move(e){
  const p=e.touches?e.touches[0]:e;
  glow.style.left=p.clientX+"px";
  glow.style.top=p.clientY+"px";
}
window.addEventListener("mousemove",move);
window.addEventListener("touchmove",move,{passive:true});
</script>

</body>
</html>
