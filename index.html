<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>跨年倒數</title>

<style>
:root{
  --bgColor:#05060a;
  --glowColor:#6ee7ff;
}

html,body{
  margin:0;
  height:100%;
  overflow:hidden;
  background:#000;
  font-family:"Noto Sans TC","Microsoft JhengHei",system-ui;
  color:#fff;
}

/* ===== 主內容 ===== */
.center{
  position:relative;
  z-index:2;
  height:100%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
}

h1{
  letter-spacing:6px;
  font-weight:500;
  text-shadow:0 0 16px var(--glowColor);
}

.time{
  margin-top:16px;
  font-size:clamp(36px,6vw,76px);
  font-weight:900;
  text-shadow:
    0 0 22px var(--glowColor),
    0 0 44px color-mix(in srgb, var(--glowColor) 60%, transparent);
}

/* ===== Canvas ===== */
canvas{
  position:fixed;
  inset:0;
  z-index:1;
}

/* ===== 控制面板 ===== */
#panel{
  position:fixed;
  right:16px;
  bottom:16px;
  background:rgba(0,0,0,.6);
  backdrop-filter:blur(10px);
  border-radius:14px;
  padding:12px 14px;
  font-size:12px;
  z-index:5;
  width:190px;
}
#panel label{
  display:block;
  opacity:.75;
  margin-top:10px;
  margin-bottom:4px;
}
#panel input[type=color]{
  width:32px;
  height:32px;
  border:none;
  background:none;
  cursor:pointer;
}
#panel input[type=range]{
  width:100%;
}
</style>
</head>

<body>

<canvas id="canvas"></canvas>

<div class="center">
  <h1>距離跨年還有</h1>
  <div class="time" id="countdown">0 天 0 小時 0 分 0 秒</div>
  <div>Asia / Taipei</div>
</div>

<div id="panel">
  <label>背景顏色</label>
  <input type="color" id="bgPicker" value="#05060a">

  <label>粒子 / 文字發光</label>
  <input type="color" id="glowPicker" value="#6ee7ff">

  <label>粒子數量</label>
  <input type="range" id="countRange" min="30" max="300" value="120">

  <label>粒子速度</label>
  <input type="range" id="speedRange" min="0.2" max="3" step="0.1" value="1">
</div>

<script>
/* ===== Canvas ===== */
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
resize();
addEventListener("resize", resize);
function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}

/* ===== 狀態 ===== */
let bgColor = "#05060a";
let glowColor = "#6ee7ff";
let targetCount = 120;
let speedFactor = 1;

/* ===== 粒子 ===== */
let particles = [];

function createParticle(){
  return{
    x:Math.random()*canvas.width,
    y:canvas.height + Math.random()*200,
    vx:(Math.random()-0.5)*0.15,
    vy:-(Math.random()*0.6 + 0.2),
    r:Math.random()*2+0.8,
    phase:Math.random()*Math.PI*2
  };
}

function syncParticles(){
  while(particles.length < targetCount) particles.push(createParticle());
  while(particles.length > targetCount) particles.pop();
}
syncParticles();

/* ===== 控制 ===== */
document.getElementById("bgPicker").oninput = e=>{
  bgColor = e.target.value;
  document.documentElement.style.setProperty("--bgColor", bgColor);
};

document.getElementById("glowPicker").oninput = e=>{
  glowColor = e.target.value;
  document.documentElement.style.setProperty("--glowColor", glowColor);
};

document.getElementById("countRange").oninput = e=>{
  targetCount = +e.target.value;
  syncParticles();
};

document.getElementById("speedRange").oninput = e=>{
  speedFactor = +e.target.value;
};

/* ===== 動畫 ===== */
function animate(){
  /* 黑色動態背景 */
  ctx.fillStyle = bgColor;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle = "rgba(255,255,255,0.015)";
  ctx.fillRect(
    Math.sin(Date.now()*0.00025)*60,
    Math.cos(Date.now()*0.00018)*60,
    canvas.width,
    canvas.height
  );

  /* 粒子（由下往上 + 發光 + 速度可調） */
  particles.forEach(p=>{
    p.x += p.vx * speedFactor;
    p.y += p.vy * speedFactor;
    p.phase += 0.025 * speedFactor;

    if(p.y < -60){
      Object.assign(p, createParticle());
    }

    const alpha = 0.5 + Math.sin(p.phase)*0.4;

    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fillStyle = glowColor;
    ctx.globalAlpha = alpha;
    ctx.shadowBlur = 24;
    ctx.shadowColor = glowColor;
    ctx.fill();
  });

  ctx.globalAlpha = 1;
  ctx.shadowBlur = 0;

  requestAnimationFrame(animate);
}
animate();

/* ===== 倒數（台灣時間） ===== */
const cd = document.getElementById("countdown");
function nextNY(){
  const now = new Date(
    new Date().toLocaleString("en-US",{timeZone:"Asia/Taipei"})
  );
  return new Date(now.getFullYear()+1,0,1,0,0,0);
}
const target = nextNY();

setInterval(()=>{
  const now = new Date(
    new Date().toLocaleString("en-US",{timeZone:"Asia/Taipei"})
  );
  let diff = target - now;
  const d = Math.floor(diff/86400000); diff%=86400000;
  const h = Math.floor(diff/3600000); diff%=3600000;
  const m = Math.floor(diff/60000);
  const s = Math.floor(diff/1000)%60;
  cd.textContent = `${d} 天 ${h} 小時 ${m} 分 ${s} 秒`;
},1000);
</script>

</body>
</html>
